/**
 * API接口调用
 * @author www.mywork99.com
 */(function(g,d){d.RESTRequest=function(a,b,c){plus.nativeUI.showWaiting();var e=new plus.net.XMLHttpRequest;b=b||{};e.onreadystatechange=function(){switch(e.readyState){case 0:console.log("xhr\u8bf7\u6c42\u5df2\u521d\u59cb\u5316");break;case 1:console.log("xhr\u8bf7\u6c42\u5df2\u6253\u5f00");break;case 2:console.log("xhr\u8bf7\u6c42\u5df2\u53d1\u9001");break;case 3:console.log("xhr\u8bf7\u6c42\u5df2\u54cd\u5e94");break;case 4:plus.nativeUI.closeWaiting();if(200==e.status){var a=JSON.parse(e.responseText||"[]");"undefined"==typeof a.errcode?c.Success(a):c.Error(a)}else setTimeout(function(){d.ShowError("\u53d1\u751f\u4e86\u901a\u8baf\u9519\u8bef\uff01")},1E3);break;default:plus.nativeUI.closeWaiting()}};e.open("POST",a);e.setRequestHeader("Content-Type","application/json");e.send(JSON.stringify(b))};d.ShowError=function(a){plus.nativeUI.toast(a)};d.MuiAjax=function(a,b,c,e,f){c=c||g.noop;e=e||g.noop;f=f?f:3;g.ajax(a,{data:JSON.stringify(b),dataType:"json",type:"post",timeout:3E3,success:function(a){"undefined"==typeof a.errcode?c(a):e(a)},error:function(g,h,k){f--;if(0<f)return console.log("try again connect\uff1a"+f),d.MuiAjax(a,b,c,e,f);d.onError("FAILED_NETWORK")}})};d.onError=function(a){switch(a){case "FAILED_NETWORK":g.toast("\u7f51\u7edc\u4e0d\u4f73");break;case "INVALID_TOKEN":wv_login.show();break;default:console.log(a)}};d.getApi=function(a,b,c,e,f){f=f||"PLUSNET";a="http://192.168.1.6/movierAPI/"+a+"?token\x3dasdqwe";c=c||g.noop;e=e||g.noop;b=b||{};console.log(a);console.log(JSON.stringify(b));"PLUSNET"==f?d.RESTRequest(a,b,{Success:function(a){console.log("Api request Success: "+JSON.stringify(a));c(a)},Error:function(a){console.log("Api request Error: "+JSON.stringify(a));e(a)}}):"MUIAJAX"==f&&d.MuiAjax(a,b,c,e,3)};d.getSmsCode=function(a,b,c){d.getApi("public/getsmscode",a,b,c)};d.register=function(a,b,c){d.getApi("User/register",a,b,c)};d.updateInfo=function(a,b,c){d.getApi("user/updateinfo",a,b,c)};d.login=function(a,b,c){d.getApi("User/login",a,b,c)};d.getUserInfo=function(a,b,c){d.getApi("User/userinfo",a,b,c)};d.publishWorks=function(a,b,c){d.getApi("Publish/works",a,b,c)};d.publishTrade=function(a,b,c){d.getApi("Publish/trade",a,b,c)};d.publishEvent=function(a,b,c){d.getApi("Publish/event",a,b,c)};d.publishDemand=function(a,b,c){d.getApi("Publish/demand",a,b,c)};d.getPublishList=function(a,b,c){d.getApi("Publish/getlist",a,b,c)};d.getPublishDetail=function(a,b,c){d.getApi("Publish/getdetail",a,b,c)};d.addPublish=function(a,b,c){d.getApi("Publish/create",a,b,c)};d.updateUserPos=function(a,b,c){d.getApi("User/updatepos",a,b,c)};d.NearbyMovier=function(a,b,c){d.getApi("Nearby/movier",a,b,c)};d.NearbyMovierMap=function(a,b,c){d.getApi("Nearby/movierMap",a,b,c)}})(mui,window.Api={});