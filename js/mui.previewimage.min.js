(function(d,k){var m=document.createElement("div"),n=function(a){this.options=d.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'\x3cspan class\x3d"mui-preview-indicator"\x3e\x3c/span\x3e',footer:""},a||{});this.init();this.initEvent()},e=n.prototype;e.init=function(){var a=this.options,b=document.getElementById(this.options.id);b||(m.innerHTML='\x3cdiv id\x3d"{{id}}" class\x3d"mui-slider mui-preview-image mui-fullscreen"\x3e\x3cdiv class\x3d"mui-preview-header"\x3e{{header}}\x3c/div\x3e\x3cdiv class\x3d"mui-slider-group"\x3e\x3c/div\x3e\x3cdiv class\x3d"mui-preview-footer mui-hidden"\x3e{{footer}}\x3c/div\x3e\x3cdiv class\x3d"mui-preview-loading"\x3e\x3cspan class\x3d"mui-spinner mui-spinner-white"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e'.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",a.header).replace("{{footer}}",a.footer),document.body.appendChild(m.firstElementChild),b=document.getElementById(this.options.id));this.element=b;this.scroller=this.element.querySelector(d.classSelector(".slider-group"));this.indicator=this.element.querySelector(d.classSelector(".preview-indicator"));this.loader=this.element.querySelector(d.classSelector(".preview-loading"));a.footer&&this.element.querySelector(d.classSelector(".preview-footer")).classList.remove(d.className("hidden"));this.addImages()};e.initEvent=function(){var a=this;d(document.body).on("tap","img[data-preview-src]",function(){a.open(this);return!1});var b=null,c=function(){!b&&(b=d.later(function(){a.loader.removeEventListener("tap",c);a.scroller.removeEventListener("tap",c);a.close()},300))};this.scroller.addEventListener("doubletap",function(){b&&(b.cancel(),b=null)});this.element.addEventListener("webkitAnimationEnd",function(){a.element.classList.contains(d.className("preview-out"))?(a.element.style.display="none",a.element.classList.remove(d.className("preview-out")),a.element.classList.remove(d.className("preview-in")),b=null):(a.loader.addEventListener("tap",c),a.scroller.addEventListener("tap",c))});this.element.addEventListener("slide",function(b){if(a.options.zoom){var c=a.element.querySelector(".mui-zoom-wrapper:nth-child("+(a.lastIndex+1)+")");c&&d(c).zoom().setZoom(1)}b=b.detail.slideNumber;a.lastIndex=b;a.indicator&&(a.indicator.innerText=b+1+"/"+a.currentGroup.length);a._loadItem(b)})};e.addImages=function(a,b){this.groups={};var c;c=a?"__DEFAULT"===a?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group\x3d'"+a+"']"):document.querySelectorAll("img[data-preview-src]");if(c.length)for(var h=0,d=c.length;h<d;h++)this.addImage(c[h])};e.addImage=function(a){var b=a.getAttribute("data-preview-group"),b=b||"__DEFAULT";this.groups[b]||(this.groups[b]=[]);var c=a.getAttribute("src");if(a.__mui_img_data&&a.__mui_img_data.src===c)this.groups[b].push(a.__mui_img_data);else{var d=a.getAttribute("data-preview-src");d||(d=c);c={src:c,lazyload:c===d?"":d,loaded:c===d?!0:!1,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:a};this.groups[b].push(c);a.__mui_img_data=c}};e.empty=function(){this.scroller.innerHTML=""};e._initImgData=function(a,b){if(!a.sWidth){var c=a.el;a.sWidth=c.offsetWidth;a.sHeight=c.offsetHeight;c=d.offset(c);a.sTop=c.top;a.sLeft=c.left;a.sScale=Math.max(a.sWidth/k.innerWidth,a.sHeight/k.innerHeight)}b.style.webkitTransform="translate3d(0,0,0) scale("+a.sScale+")"};e._getScale=function(a,b){var c=a.width/b.width,d=a.height/b.height;return c<=d?a.height/(b.height*c):a.width/(b.width*d)};e._imgTransitionEnd=function(a){a=a.target;a.classList.remove(d.className("transitioning"));a.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))};e._loadItem=function(a,b){var c=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(a+1)+")")),h=this.currentGroup[a],f=c.querySelector("img");this._initImgData(h,f);if(b){var e=this._getPosition(h);f.style.webkitTransitionDuration="0ms";f.style.webkitTransform="translate3d("+e.x+"px,"+e.y+"px,0) scale("+h.sScale+")";f.offsetHeight}if(!h.loaded&&f.getAttribute("data-preview-lazyload")){var g=this;g.loader.classList.add(d.className("active"));f.style.webkitTransitionDuration="0.5s";f.addEventListener("webkitTransitionEnd",g._imgTransitionEnd.bind(g));f.style.webkitTransform="translate3d(0,0,0) scale("+h.sScale+")";this.loadImage(f,function(){h.loaded=!0;f.src=h.lazyload;g._initZoom(c,this.width,this.height);f.classList.add(d.className("transitioning"));f.addEventListener("webkitTransitionEnd",g._imgTransitionEnd.bind(g));f.setAttribute("style","");f.offsetHeight;g.loader.classList.remove(d.className("active"))})}else h.lazyload&&(f.src=h.lazyload),this._initZoom(c,f.width,f.height),f.classList.add(d.className("transitioning")),f.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),f.setAttribute("style",""),f.offsetHeight;this._preloadItem(a+1);this._preloadItem(a-1)};e._preloadItem=function(a){var b=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(a+1)+")"));b&&(a=this.currentGroup[a],a.sWidth||(b=b.querySelector("img"),this._initImgData(a,b)))};e._initZoom=function(a,b,c){this.options.zoom&&!a.getAttribute("data-zoomer")&&("IMG"===a.querySelector(d.classSelector(".zoom")).tagName?(b=this._getScale({width:a.offsetWidth,height:a.offsetHeight},{width:b,height:c}),d(a).zoom({maxZoom:Math.max(b,1)})):d(a).zoom())};e.loadImage=function(a,b){var c=function(){b&&b.call(this)},d=new Image;d.onload=c;d.onerror=c;d.src=a.getAttribute("data-preview-lazyload")};e.getRangeByIndex=function(a,b){return{from:0,to:b-1}};e._getPosition=function(a){var b=a.sLeft-k.pageXOffset,c=a.sTop-k.pageYOffset;return{left:b,top:c,x:b-(k.innerWidth-a.sWidth)/2,y:c-(k.innerHeight-a.sHeight)/2}};e.refresh=function(a,b){this.currentGroup=b;for(var c=[],h=this.getRangeByIndex(a,b.length),f=h.from,h=h.to+1,e=a,g,k,l=0;f<h;f++,l++)g=b[f],k="",g.sWidth&&(k="-webkit-transform:translate3d(0,0,0) scale("+g.sScale+");transform:translate3d(0,0,0) scale("+g.sScale+")"),k='\x3cdiv class\x3d"mui-slider-item mui-zoom-wrapper {{className}}"\x3e\x3cdiv class\x3d"mui-zoom-scroller"\x3e\x3cimg src\x3d"{{src}}" data-preview-lazyload\x3d"{{lazyload}}" style\x3d"{{style}}" class\x3d"mui-zoom"\x3e\x3c/div\x3e\x3c/div\x3e'.replace("{{src}}",g.src).replace("{{lazyload}}",g.lazyload).replace("{{style}}",k),f===a?(e=l,g=d.className("active")):g="",c.push(k.replace("{{className}}",g));this.scroller.innerHTML=c.join("");this.element.style.display="block";this.element.classList.add(d.className("preview-in"));this.lastIndex=e;this.element.offsetHeight;d(this.element).slider().gotoItem(e,0);this.indicator&&(this.indicator.innerText=e+1+"/"+this.currentGroup.length);this._loadItem(e,!0)};e.openByGroup=function(a,b){a=Math.min(Math.max(0,a),this.groups[b].length-1);this.refresh(a,this.groups[b])};e.open=function(a,b){this.isShown()||("number"===typeof a?(b=b||"__DEFAULT",this.addImages(b,a),this.openByGroup(a,b)):(b=(b=a.getAttribute("data-preview-group"))||"__DEFAULT",this.addImages(b,a),this.openByGroup(this.groups[b].indexOf(a.__mui_img_data),b)))};e.close=function(a,b){if(this.isShown()){this.element.classList.remove(d.className("preview-in"));this.element.classList.add(d.className("preview-out"));var c=this.scroller.querySelector(d.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")).querySelector("img");if(c){c.classList.add(d.className("transitioning"));var e=this.currentGroup[this.lastIndex],f=this._getPosition(e),l=f.left,g=f.top;g>k.innerHeight||l>k.innerWidth||0>g||0>l?(c.style.opacity=0,c.style.webkitTransitionDuration="0.5s",c.style.webkitTransform="scale("+e.sScale+")"):(this.options.zoom&&d(c.parentNode.parentNode).zoom().toggleZoom(0),c.style.webkitTransitionDuration="0.5s",c.style.webkitTransform="translate3d("+f.x+"px,"+f.y+"px,0) scale("+e.sScale+")")}c=this.element.querySelectorAll(d.classSelector(".zoom-wrapper"));e=0;for(f=c.length;e<f;e++)d(c[e]).zoom().destroy();d(this.element).slider().destroy()}};e.isShown=function(){return this.element.classList.contains(d.className("preview-in"))};var l=null;d.previewImage=function(a){l||(l=new n(a));return l};d.getPreviewImage=function(){return l}})(mui,window);