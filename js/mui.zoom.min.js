(function(e,Q){var R=e.className("zoom"),S=e.className("zoom-scroller"),T="."+R,U="."+S,L="pinchstart",M="pinch",N="pinchend";"ongesturestart"in Q&&(L="gesturestart",M="gesturechange",N="gestureend");e.Zoom=function(y,v){var a=this;a.options=e.extend(e.Zoom.defaults,v);a.wrapper=a.element=y;a.scroller=y.querySelector(U);a.scrollerStyle=a.scroller&&a.scroller.style;a.zoomer=y.querySelector(T);a.zoomerStyle=a.zoomer&&a.zoomer.style;a.init=function(){e.options.gestureConfig.pinch=!0;e.options.gestureConfig.doubletap=!0;a.initEvents()};a.initEvents=function(b){b=b?"removeEventListener":"addEventListener";var c=a.scroller;c[b](L,a.onPinchstart);c[b](M,a.onPinch);c[b](N,a.onPinchend);c[b](e.EVENT_START,a.onTouchstart);c[b](e.EVENT_MOVE,a.onTouchMove);c[b](e.EVENT_CANCEL,a.onTouchEnd);c[b](e.EVENT_END,a.onTouchEnd);c[b]("drag",a.dragEvent);c[b]("doubletap",a.doubleTapEvent)};a.dragEvent=function(a){(u||K)&&a.stopPropagation()};a.doubleTapEvent=function(b){a.toggleZoom(b.detail.center)};a.transition=function(b,c){b.webkitTransitionDuration=(c||0)+"ms";return a};a.translate=function(b,c,d){b.webkitTransform="translate3d("+(c||0)+"px,"+(d||0)+"px,0px)";return a};a.scale=function(b,c){b.webkitTransform="translate3d(0,0,0) scale("+(c||1)+")";return a};a.scrollerTransition=function(b){return a.transition(a.scrollerStyle,b)};a.scrollerTransform=function(b,c){return a.translate(a.scrollerStyle,b,c)};a.zoomerTransition=function(b){return a.transition(a.zoomerStyle,b)};a.zoomerTransform=function(b){return a.scale(a.zoomerStyle,b)};var d=1,z=1,H=!1,K=!1;a.onPinchstart=function(a){K=!0};a.onPinch=function(b){H||(a.zoomerTransition(0),H=!0);d=(b.detail?b.detail.scale:b.scale)*z;d>a.options.maxZoom&&(d=a.options.maxZoom-1+Math.pow(d-a.options.maxZoom+1,.5));d<a.options.minZoom&&(d=a.options.minZoom+1-Math.pow(a.options.minZoom-d+1,.5));a.zoomerTransform(d)};a.onPinchend=function(b){d=Math.max(Math.min(d,a.options.maxZoom),a.options.minZoom);a.zoomerTransition(a.options.speed).zoomerTransform(d);z=d;H=!1};a.setZoom=function(b){d=z=b;a.scrollerTransition(a.options.speed).scrollerTransform(0,0);a.zoomerTransition(a.options.speed).zoomerTransform(d)};a.toggleZoom=function(b,c){"number"===typeof b&&(c=b,b=void 0);c="undefined"===typeof c?a.options.speed:c;if(d&&1!==d)d=z=1,a.scrollerTransition(c).scrollerTransform(0,0);else if(d=z=a.options.maxZoom,b){var f=e.offset(a.zoomer),g=(b.x-f.left)*d,f=(b.y-f.top)*d;this._cal();g>=h&&g<=h+n?g=h-g+n/2:g<h?g=h-g+n/2:g>h+n&&(g=h+n-g-n/2);f>=k&&f<=k+p?f=k-f+p/2:f<k?f=k-f+p/2:f>k+p&&(f=k+p-f-p/2);g=Math.min(Math.max(g,q),h);f=Math.min(Math.max(f,r),k);a.scrollerTransition(c).scrollerTransform(g,f)}else a.scrollerTransition(c).scrollerTransform(0,0);a.zoomerTransition(c).zoomerTransform(d)};a._cal=function(){n=a.wrapper.offsetWidth;p=a.wrapper.offsetHeight;A=a.zoomer.offsetWidth;B=a.zoomer.offsetHeight;var b=B*d;q=Math.min(n/2-A*d/2,0);h=-q;r=Math.min(p/2-b/2,0);k=-r};var n,p,w,u,l,m,q,r,h,k,A,B,I,O,t,x,J,P,C,D,E,F,G;a.onTouchstart=function(a){a.preventDefault();w=!0;I=a.type===e.EVENT_START?a.targetTouches[0].pageX:a.pageX;O=a.type===e.EVENT_START?a.targetTouches[0].pageY:a.pageY};a.onTouchMove=function(b){b.preventDefault();if(w){if(!u){n=a.wrapper.offsetWidth;p=a.wrapper.offsetHeight;A=a.zoomer.offsetWidth;B=a.zoomer.offsetHeight;var c=e.parseTranslateMatrix(e.getStyles(a.scroller,"webkitTransform"));J=c.x||0;P=c.y||0;a.scrollerTransition(0)}var c=A*d,f=B*d;c<n&&f<p||(q=Math.min(n/2-c/2,0),h=-q,r=Math.min(p/2-f/2,0),k=-r,t=b.type===e.EVENT_MOVE?b.targetTouches[0].pageX:b.pageX,x=b.type===e.EVENT_MOVE?b.targetTouches[0].pageY:b.pageY,u||H||!(Math.floor(q)===Math.floor(J)&&t<I||Math.floor(h)===Math.floor(J)&&t>I)?(u=!0,l=t-I+J,m=x-O+P,l<q&&(l=q+1-Math.pow(q-l+1,.8)),l>h&&(l=h-1+Math.pow(l-h+1,.8)),m<r&&(m=r+1-Math.pow(r-m+1,.8)),m>k&&(m=k-1+Math.pow(m-k+1,.8)),C||(C=t),F||(F=x),D||(D=e.now()),E=(t-C)/(e.now()-D)/2,G=(x-F)/(e.now()-D)/2,2>Math.abs(t-C)&&(E=0),2>Math.abs(x-F)&&(G=0),C=t,F=x,D=e.now(),a.scrollerTransform(l,m)):w=!1)}};a.onTouchEnd=function(b){b.touches.length||(K=!1);if(w&&u){u=w=!1;var c=300,e=300;b=l+E*c;var g=m+G*e;0!==E&&(c=Math.abs((b-l)/E));0!==G&&(e=Math.abs((g-m)/G));c=Math.max(c,e);l=b;m=g;b=B*d;q=Math.min(n/2-A*d/2,0);h=-q;r=Math.min(p/2-b/2,0);k=-r;l=Math.max(Math.min(l,h),q);m=Math.max(Math.min(m,k),r);a.scrollerTransition(c).scrollerTransform(l,m)}else u=w=!1};a.destroy=function(){a.initEvents(!0);delete e.data[a.wrapper.getAttribute("data-zoomer")];a.wrapper.setAttribute("data-zoomer","")};a.init();return a};e.Zoom.defaults={speed:300,maxZoom:3,minZoom:1};e.fn.zoom=function(y){var v=[];this.each(function(){var a,d=this.getAttribute("data-zoomer");d?a=e.data[d]:(d=++e.uuid,e.data[d]=a=new e.Zoom(this,y),this.setAttribute("data-zoomer",d));v.push(a)});return 1===v.length?v[0]:v}})(mui,window);