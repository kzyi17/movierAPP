/**
 * 系统设置，用户相关
 *  
 * 
 **/var APP_NAME="\u5f71\u4eba\u6839\u636e\u5730";(function(d,c){c.appInit=function(){console.log("appInit....");c.getGeo(function(a){var b={},e=c.getCurrentCity();b.province=a.address.province;b.city=a.address.city;b.district=a.address.district;b.address=a.addresses;b.lng=a.coords.longitude;b.lat=a.coords.latitude;b.timestamp=a.timestamp;c.setCurrentPosition(b);"undefined"==typeof e.name&&(b={},b.name=a.address.city,b.code=a.address.cityCode,c.setCurrentCity(b));var d=a.address.city;e.name!==d&&plus.nativeUI.confirm("\u7cfb\u7edf\u5b9a\u4f4d\u5230\u60a8\u5728"+d+"\uff0c\u9700\u8981\u5207\u6362\u5230"+d+"\u5417\uff1f",function(a){0==a.index&&(c.setCurrentCity({name:d}),mui.fire(plus.webview.getLaunchWebview(),"changCity"),console.log("\u5f53\u524d\u57ce\u5e02\uff1a"+d))},"",["\u5207\u6362","\u4e0d\u4e86"])})};c.autoLogin=function(a,b,c){console.log("\u81ea\u52a8\u767b\u5f55\u3002\u3002\u3002\u3002\u3002\u3002")};c.getGeo=function(a,b,e,f){a=a||d.noop;b=b||d.noop;e=f?f:5;plus.geolocation.getCurrentPosition(function(b){a(b)},function(f){e--;if(0<e)return d.toast("\u83b7\u53d6\u4f4d\u7f6e\u5931\u8d25\uff0c\u6b63\u5728\u91cd\u65b0\u83b7\u53d6..."),c.getGeo(a,b,e);b();d.alert("\u65e0\u6cd5\u83b7\u53d6\u60a8\u7684\u4f4d\u7f6e");console.log("\u83b7\u53d6\u5b9a\u4f4d\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25\uff1a"+f.message)},{geocode:!0,provider:"amap"})};c.getCurrentCity=function(){var a=localStorage.getItem("$currentCity")||"{}";return JSON.parse(a)};c.setCurrentCity=function(a){a=a||{};localStorage.setItem("$currentCity",JSON.stringify(a))};c.getCurrentPosition=function(){var a=localStorage.getItem("$currentPosition")||"{}";return JSON.parse(a)};c.setCurrentPosition=function(a){a=a||{};localStorage.setItem("$currentPosition",JSON.stringify(a))};c.checkLogin=function(){var a=localStorage.getItem("$state")||"{}";return JSON.parse(a).userID?!0:!1};c.setLogin=function(a,b){var c={userID:a};b=b||{};b.userid=a;localStorage.setItem("$state",JSON.stringify(c));localStorage.setItem("$token",JSON.stringify(b))};c.setLogout=function(){localStorage.setItem("$state",JSON.stringify({}));localStorage.setItem("$token",JSON.stringify({}))};c.getUserID=function(){var a=localStorage.getItem("$state")||"{}";return JSON.parse(a).userID};c.loginAuth=function(a){a=a||d.noop;c.checkLogin()?a():d.alert("\u60a8\u8fd8\u672a\u767b\u5f55,\u8bf7\u5148\u767b\u5f55",APP_NAME,"\u786e\u5b9a",function(){d.openWindow({url:"login.html",id:"login",show:{aniShow:"slide-in-bottom"}})})};c.openWithLogin=function(a,b){a&&(b=b||a,c.checkLogin()?d.openWindow({url:a,id:b}):d.openWindow({url:"login.html",id:"login",extras:{targetUrl:a,targetId:b},show:{aniShow:"slide-in-bottom"}}))};c.setToken=function(a){a=a||{};localStorage.setItem("$token",JSON.stringify(a))};c.getToken=function(){var a=localStorage.getItem("$token")||"{}";return JSON.parse(a)};c.setUserInfo=function(a){a=a||{};localStorage.setItem("$userInfo",JSON.stringify(a))};c.getUserInfo=function(){var a=localStorage.getItem("$userInfo")||"{}";return JSON.parse(a)}})(mui,window.App={});